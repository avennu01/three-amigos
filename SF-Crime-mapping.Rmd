---
title: "SF-Crime-mapping"
author: "Michael Woolfe"
date: "April 21, 2016"
output: html_document
---

```{r, setup, include=FALSE}
rm(list=ls()) ##Clear workingspace

library("dplyr")
library("tidyr")
library("readr")
library("ggmap")
#install.packages("rworldmap")
#library("rworldmap")
#install.packages("mapproj")  ##Here in case you need to load
library("mapproj")
library("ggplot2")
#install.packages("repmis")
library("repmis")
```

##Load the data from the Data Wrangling RMD
```{r, code=readLines("SF-Crime-Project.Rmd"), echo=FALSE}
#http://zevross.com/blog/2014/07/09/making-use-of-external-r-code-in-knitr-and-r-markdown/

```


##Load the data
```{r loading data}
  #getwd() ##Get the present directory, where the data file should reside
    #dat_crime <- read_csv(unzip("train.csv.zip")) 
##Michael: Since GitHub has an issue storing large files and each time you call 'unzip', it places the large file in the folder.  So I loaded the file into a DropBox folder for sharing
dat_crime <- read_csv("https://www.dropbox.com/s/kjkt5ndf3jkibq4/train.csv?raw=1")


  #table(dat_crime$Category)
#dat_crime %>% plot(dat_crime, x = dat_crime$X, y = dat_crime$Y, type = "p")
#plot(dat_crime$X, dat_crime$Y, type = "p")

#x <- dat_crime$X ##Latitude
#y <- dat_crime$Y ##Longitude
#plot (x,y)
#dat_crime %>% plot(.)



##Using rworldmap package
#rworld_map <- getMap(resolution = "low")
#plot (rworld_map, xlim = c(-20, 59), ylim = c(35, 71), asp = 1)


```

```{r plain ggmap}

##
map_SF <- get_map(location = "San Francisco", zoom = 13)
ggmap(map_SF)


#Different views : http://www.r-bloggers.com/throw-some-throw-some-stats-on-that-mappart-1/


```


```{r ggmap plus points}
## install.packages("rgbif") ##For insatl
#library("rgbif")  #Decided that this is not useful, but leaving here for now
##
map_SF <- get_map(location = "San Francisco", zoom = 13)

##Warning, this one looks like a mess
ggmap(map_SF) +
    geom_jitter(data = dat_crime, aes(X, Y), alpha=0.2, size=0.5, color="red") 



##From: http://www.r-bloggers.com/map-biodiversity-records-with-rgbif-and-ggmap-packages-in-r/
```

```{r first walking path}

walking_from_1 <- "1 Telegraph Hill Blvd, San Francisco, CA 94133" #Colt Tower
walking_to_1 <- "1201 Mason St, San Francisco, CA 94108"  #Cable Car museum
walking_route_1 <- route(walking_from_1, walking_to_1, structure = 'route', mode = 'walking', alternative = FALSE)

##Need to figure out how to auto-focus the map
map_SF_1 <- get_map(location = "Washington Square Park, San Francisco, CA 94133", zoom = 16)


ggmap(map_SF_1) + 
    geom_path(data = walking_route_1,
        aes(x = lon, y = lat), color="red", size = 1.5, lineend='round'
    )




#https://rpubs.com/nickbearman/r-google-map-making
#https://www.google.com/maps/dir/Coit+Tower,+1+Telegraph+Hill+Blvd,+San+Francisco,+CA+94133/Cable+Car+Museum,+Mason+Street,+San+Francisco,+CA/@37.7991066,-122.4139408,16z/data=!3m1!4b1!4m13!4m12!1m5!1m1!1s0x8085808c40000001:0xde85b80121f2dd44!2m2!1d-122.4058222!2d37.8023949!1m5!1m1!1s0x808580f2960c5a5f:0xdfcd6cebc1ae9a35!2m2!1d-122.411488!2d37.7946268
```


```{r first walking path + crime}
#install.packages("fields")
library("fields")
walking_route_1

##Count the number of route steps
###Take off a count 
walking_route_1_hop_count <- nrow(walking_route_1) - 1

#Trying to find crime nearby


##OLD Approach::
dat_crime_route_1 <- dat_crime %>% filter(Y <= (walking_route_1$lat[1] + 0.0001),Y >= (walking_route_1$lat[1] - 0.0001),X <= (walking_route_1$lon[1] - 0.001), X >= -122.408)

#dat_crime_route_1 %>% select(X, Y)

##This just renders the crime within the lat/lon constraints of how the map was centered
ggmap(map_SF_1) + 
    geom_path(data = walking_route_1,
        aes(x = lon, y = lat), color="blue", size = 1.5, lineend='round'
    ) + 
  geom_jitter(data = dat_crime_route_1, aes(X, Y), alpha=1, size=3, color="red") 

###TO DO
# Additional line segments
# Create two additional walking 
# Determine geo distance as it relates to lat/lon
```





